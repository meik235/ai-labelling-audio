<!-- @format -->

# Local Testing Scripts

This folder contains scripts for local testing and audio processing.

## Files

- **`generate_audio.py`** - Generates test audio files (mono/stereo, Hindi/Bengali)
- **`preprocess_only.py`** - Runs preprocessing pipeline locally and saves results for comparison

## Output Structure

All outputs are generated inside the `local_testing/` folder:

```
local_testing/
├── output_audios/              # Generated by generate_audio.py
│   ├── 1_mono_hindi_food.mp3
│   ├── 2_mono_bengali_food.mp3
│   └── ...
└── preprocessing_output/        # Generated by preprocess_only.py
    ├── original/
    ├── processed/
    └── *.json
```

---

## 1. Generate Audio Files

**Purpose:** Creates test audio files for testing the preprocessing pipeline.

**Requirements:**

```bash
pip install gtts pydub
```

**Run:**

```bash
cd local_testing
python3 generate_audio.py
```

**Output:**

- Creates `local_testing/output_audios/` folder with 6 audio files:
  - `1_mono_hindi_food.mp3` - Mono single speaker (Hindi)
  - `2_mono_bengali_food.mp3` - Mono single speaker (Bengali)
  - `3_mono_hindi_fashion.mp3` - Mono two speakers (Hindi)
  - `4_mono_bengali_fashion.mp3` - Mono two speakers (Bengali)
  - `5_stereo_hindi_gardening.mp3` - Stereo two speakers (Hindi)
  - `6_stereo_bengali_gardening.mp3` - Stereo two speakers (Bengali)

---

## 2. Preprocess Audio Files

**Purpose:** Runs the preprocessing pipeline locally and saves original + processed audio files for comparison.

**Requirements:**

- Virtual environment activated (if using one)
- All project dependencies installed
- Can be run from project root or from `local_testing/` directory

**Run:**

```bash
# Option 1: From project root directory (recommended)
python3 local_testing/preprocess_only.py --config config/modules.yaml

# Option 2: From local_testing directory
cd local_testing
python3 preprocess_only.py --config ../config/modules.yaml
```

**Options:**

- `--config` - Path to modules.yaml config file (default: `config/modules.yaml`)
- `--output` - Output directory for results (default: `local_testing/preprocessing_output`)

**Output:**

- Creates `local_testing/preprocessing_output/` folder with:
  - `original/` - Original audio files (downloaded from CSV URLs)
  - `processed/` - Preprocessed audio files (mono 16kHz WAV)
  - `*.json` - Metadata files showing preprocessing steps applied

**What it does:**

1. Reads audio URLs from your CSV file (configured in `config/modules.yaml`)
2. Downloads each audio file
3. Applies preprocessing (standardization to mono 16kHz WAV, plus any enabled features)
4. Saves both original and processed versions for side-by-side comparison

**Note:** This script uses the exact same preprocessing logic as the main pipeline, so you can compare results locally before running the full pipeline.

---

## Quick Start Example

```bash
# 1. Generate test audio files
cd local_testing
python3 generate_audio.py

# 2. (Optional) Upload generated files to S3 or update CSV with local paths

# 3. Run preprocessing on your audio files
cd ..  # Back to project root
python3 local_testing/preprocess_only.py --config config/modules.yaml

# 4. Compare original vs processed files in local_testing/preprocessing_output/
```

---

## Troubleshooting

**"python: command not found"**

- Use `python3` instead of `python` on macOS

**"Module not found" errors**

- Make sure you're in the project root directory when running `preprocess_only.py`
- Activate virtual environment: `source .venv/bin/activate`

**"Config file not found"**

- Make sure you're running from the project root directory
- Check that `config/modules.yaml` exists
